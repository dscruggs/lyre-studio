# Cloud Build config for backend service
# Specifies Dockerfile.backend instead of default Dockerfile
# Pass HF_TOKEN via: --substitutions=_HF_TOKEN=$HF_TOKEN
steps:
  - name: 'gcr.io/cloud-builders/docker'
    args:
      - 'build'
      - '-t'
      - 'gcr.io/$PROJECT_ID/lyre-backend'
      - '-f'
      - 'Dockerfile.backend'
      - '--build-arg'
      - 'HF_TOKEN=$_HF_TOKEN'
      - '.'
images:
  - 'gcr.io/$PROJECT_ID/lyre-backend'

substitutions:
  _HF_TOKEN: ''  # Default empty, should be passed via --substitutions

# Increase timeout for model downloads (default is 10 min)
timeout: '3600s'
